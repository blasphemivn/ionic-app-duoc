<div class="login-container" #loginContainer>
  <div class="logo-container" #logoContainer>
    <img src="../../assets/img/image.png" alt="Logo" class="logo-img" />
  </div>

  <div class="form-container" #formContainer>
    <!-- Toggle entre login y registro -->
    <div class="mode-toggle">
      <ion-button 
        fill="clear" 
        [color]="!isRegisterMode ? 'primary' : 'medium'"
        (click)="toggleMode()"
        [disabled]="isLoading">
        Iniciar Sesión
      </ion-button>
      <ion-button 
        fill="clear" 
        [color]="isRegisterMode ? 'primary' : 'medium'"
        (click)="toggleMode()"
        [disabled]="isLoading">
        Registrarse
      </ion-button>
    </div>

    <form (submit)="isRegisterMode ? register() : login()">
      <div>
        <ion-item>
          <ion-input 
            label="Email" 
            type="email" 
            [(ngModel)]="email" 
            name="email" 
            placeholder="email@domain.com"
            (ionInput)="onEmailChange()"
            [class.error]="emailError"
            [disabled]="isLoading">
          </ion-input>
        </ion-item>
        <ion-label *ngIf="emailError" color="danger" class="error-message">
          {{ emailError }}
        </ion-label>
    
        <ion-item class="ion-margin-top">
          <ion-input 
            type="password" 
            label="Contraseña" 
            [(ngModel)]="password" 
            name="password" 
            placeholder="Ingresa tu contraseña"
            (ionInput)="onPasswordChange()"
            [class.error]="passwordError"
            [disabled]="isLoading">
            <ion-input-password-toggle slot="end"></ion-input-password-toggle>
          </ion-input>
        </ion-item>
        <ion-label *ngIf="passwordError" color="danger" class="error-message">
          {{ passwordError }}
        </ion-label>

        <!-- Campo de confirmación de contraseña (solo en modo registro) -->
        <ion-item class="ion-margin-top" *ngIf="isRegisterMode">
          <ion-input 
            type="password" 
            label="Confirmar Contraseña" 
            [(ngModel)]="confirmPassword" 
            name="confirmPassword" 
            placeholder="Confirma tu contraseña"
            (ionInput)="onConfirmPasswordChange()"
            [class.error]="confirmPasswordError"
            [disabled]="isLoading">
            <ion-input-password-toggle slot="end"></ion-input-password-toggle>
          </ion-input>
        </ion-item>
        <ion-label *ngIf="confirmPasswordError && isRegisterMode" color="danger" class="error-message">
          {{ confirmPasswordError }}
        </ion-label>
      </div>

      <ion-button 
        expand="block" 
        type="submit" 
        [disabled]="!isFormValid || isLoading">
        <ion-spinner *ngIf="isLoading" name="crescent" class="login-spinner"></ion-spinner>
        <span *ngIf="!isLoading && !isRegisterMode">Iniciar sesión</span>
        <span *ngIf="!isLoading && isRegisterMode">Registrarse</span>
        <span *ngIf="isLoading && !isRegisterMode">Iniciando sesión...</span>
        <span *ngIf="isLoading && isRegisterMode">Registrando...</span>
      </ion-button>
    </form>

    <!-- Sección de recuperación de contraseña (solo en modo login) -->
    <div class="recovery-section" *ngIf="!isRegisterMode">
      <ion-button 
        fill="clear" 
        color="medium" 
        (click)="goToPasswordRecovery()"
        [disabled]="isLoading">
        ¿Olvidaste tu contraseña?
      </ion-button>
    </div>

    <!-- Botones de desarrollo (solo para testing) -->
    <div class="dev-tools" *ngIf="!isLoading">
      <ion-button 
        fill="clear" 
        color="tertiary" 
        size="small"
        (click)="showRegisteredUsers()">
        👥 Ver usuarios
      </ion-button>
      <ion-button 
        fill="clear" 
        color="danger" 
        size="small"
        (click)="clearAllUsers()">
        🗑️ Limpiar datos
      </ion-button>
    </div>

    <div class="version-info">
      <span>
        Versión 1.0.0
      </span>
    </div>
  </div>
</div>

<ion-toast
    [isOpen]="isToastOpen"
    [message]="toastMessage"
    [duration]="5000"
    (didDismiss)="isToastOpen = false"
  ></ion-toast>